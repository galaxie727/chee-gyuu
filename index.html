<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>チーと言えばギュウと答える</title>

<style>
:root{
  --text:#ffffff;
  --muted:#dddddd;
}
*{ box-sizing:border-box; }
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP","Segoe UI",sans-serif;
  color:var(--text);
  background:#000;
  min-height:100svh;
}
.app{
  width:min(560px,100%);
  margin:0 auto;
  min-height:100svh;
  display:flex;
  flex-direction:column;
}

/* ===== Header ===== */
header{
  padding:12px 16px 10px;
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  position:sticky;
  top:0;
  z-index:20;
}
.title{
  font-size:14px;
  font-weight:900;
  letter-spacing:0.12em;
}
.meta{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
  font-size:12px;
  color:var(--muted);
}
.minirow{
  display:flex;
  gap:10px;
  align-items:center;
}

/* ===== Time Gauge ===== */
.gauge{
  width:180px;
  height:8px;
  border-radius:999px;
  background:rgba(255,255,255,0.12);
  overflow:hidden;
}
.gauge > div{
  height:100%;
  width:100%;
  transform-origin:left center;
  transform:scaleX(0);
  transition:transform 50ms linear, background-color 50ms linear;
}

/* ===== Screen ===== */
.screen{ flex:1; position:relative; overflow:hidden; }
.bg{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  transform:scale(1.02);
  transition:transform 180ms ease;
}
#startScreen .bg{ background-image:url("girl_top.png"); }

/* チー娘中だけズーム */
#gameScreen.chee-mode .bg{
  transform:scale(1.12);
}

/* 暗転 */
.cutCover{
  position:absolute;
  inset:0;
  background:#000;
  opacity:0;
  pointer-events:none;
  transition:opacity 220ms linear;
  z-index:5;
}
#gameScreen.cut .cutCover{ opacity:1; }

/* !! ショック */
.shock{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:72px;
  font-weight:900;
  letter-spacing:0.08em;
  opacity:0;
  pointer-events:none;
  z-index:7;
  transition:opacity 120ms linear;
}
#gameScreen.shock-on .shock{ opacity:1; }

/* チー娘登場！！ */
.announce{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  font-weight:900;
  letter-spacing:0.2em;
  opacity:0;
  pointer-events:none;
  z-index:8;
  transition:opacity 120ms ease;
}
#gameScreen.announce-on .announce{ opacity:1; }

/* 画面シェイク */
@keyframes screenShake {
  0%{transform:translate(0,0)}
  25%{transform:translate(-4px,2px)}
  50%{transform:translate(3px,-2px)}
  75%{transform:translate(-2px,1px)}
  100%{transform:translate(0,0)}
}
#gameScreen.shake{
  animation:screenShake 120ms linear;
}

/* ビネット */
.vignette{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:4;
  opacity:0;
  transition:opacity 180ms ease;
  background:radial-gradient(circle at center,
    rgba(0,0,0,0) 45%,
    rgba(0,0,0,0.45) 100%);
}
#gameScreen.chee-mode .vignette{ opacity:1; }

/* Overlay */
.overlay{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  padding:16px;
  gap:12px;
  background:linear-gradient(to bottom, rgba(0,0,0,0.15), rgba(0,0,0,0.45));
  z-index:10;
}

/* Bubble */
.bubble{
  background:rgba(255,255,255,0.08);
  border-radius:14px;
  padding:14px;
  min-height:96px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  transition:transform 120ms ease;
}
#gameScreen.chee-mode .bubble{ transform:translateY(26px); }

.question{
  font-size:20px;
  font-weight:600;
  line-height:1.45;
  opacity:1;
  transition:opacity 180ms ease;
}
.question.fade{ opacity:0; }

.speech{
  align-self:flex-end;
  font-size:28px;
  font-weight:900;
  letter-spacing:0.12em;
  min-height:34px;
  opacity:1;
  transition:opacity 140ms ease;
}
.speech.fade{ opacity:0; }

/* Choices */
.choices{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
button{
  border:none;
  border-radius:12px;
  padding:14px 12px;
  font-size:16px;
  font-weight:900;
  letter-spacing:0.1em;
  color:#fff;
}
.choice-yes{background:#2e8b57}
.choice-no{background:#555}
.choice-chee{background:#2f6fb2}
.choice-gyuu{background:#e28a2f}

button:disabled{opacity:.55}
.big{
  font-size:18px;
  padding:16px 24px;
  background:#ffffff22;
}

/* ===== Layout ===== */
.hide{display:none}
#startScreen .panel{text-align:center}
#startBtn{margin:0 auto;display:block}
.heroTitle{
  font-size:18px;
  font-weight:900;
  letter-spacing:0.14em;
}
</style>
</head>

<body>
<div class="app">

<header>
  <div class="title">チーと言えばギュウと答える</div>
  <div class="meta">
    <div class="minirow">
      <span id="counter">-</span>
      <span id="countdown">-</span>
    </div>
    <div class="gauge"><div id="gaugeBar"></div></div>
  </div>
</header>

<!-- START -->
<div id="startScreen" class="screen">
  <div class="bg"></div>
  <div class="overlay">
    <div class="panel">
      <div class="heroTitle">ガチ！チー牛診断！！</div>
      <button class="big" id="startBtn">START</button>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="gameScreen" class="screen hide">
  <div class="bg"></div>
  <div class="vignette"></div>
  <div class="cutCover"></div>
  <div class="shock">!!</div>
  <div class="announce">チー娘登場！！</div>

  <div class="overlay">
    <div class="bubble">
      <div class="question" id="question"></div>
      <div class="speech" id="speech"></div>
    </div>
    <div class="choices" id="choices"></div>
  </div>
</div>

</div>

<script>
/* ===== 設定 ===== */
const questions = [
  "あなたはチー牛ですか？",
  "チーと言えば？",
  "石原さとみさんに「チー」と言われたら？",
  "ギュウと言ってもらいたい？",
  "チーズ牛丼を頼んだ人を見たことある？",
  "三度の飯よりチー牛が好き？"
];
const GIRLS=["girl_1.png","girl_2.png","girl_3.png","girl_4.png","girl_5.png","girl_6.png"];
const END="girl_end.png";

const CHEE_CHANCE=.35;
const CHEE_TIME=2200;

let current=0, mode="quiz", locked=false;
let raf=0, timeout=0;
let cheeCooldown=false, pendingAdvance=false;

/* ===== DOM ===== */
const game=document.getElementById("gameScreen");
const bg=game.querySelector(".bg");
const q=document.getElementById("question");
const s=document.getElementById("speech");
const c=document.getElementById("counter");
const cd=document.getElementById("countdown");
const gauge=document.getElementById("gaugeBar");
const choices=document.getElementById("choices");

/* ===== Helpers ===== */
const rand=a=>a[Math.floor(Math.random()*a.length)];
const shuffle=a=>a.slice().sort(()=>Math.random()-.5);

function setGauge(r){
  r=Math.max(0,Math.min(1,r));
  gauge.style.transform=`scaleX(${r})`;
  gauge.style.backgroundColor=`hsl(${210*r},85%,55%)`;
}
function stopTimer(){
  cancelAnimationFrame(raf); clearTimeout(timeout);
}
function buildButtons(){
  choices.innerHTML="";
  shuffle(["はい","いいえ","チー","ギュウ"]).forEach(t=>{
    const b=document.createElement("button");
    b.textContent=t;
    b.className="choice-"+(t==="はい"?"yes":t==="いいえ"?"no":t==="チー"?"chee":"gyuu");
    b.onclick=()=>answer(t);
    choices.appendChild(b);
  });
}

/* ===== Flow ===== */
function showQuestion(){
  mode="quiz"; locked=false;
  game.classList.remove("chee-mode");
  bg.style.backgroundImage=`url("${GIRLS[current%GIRLS.length]}")`;
  q.classList.add("fade"); s.textContent="…";
  setTimeout(()=>{
    q.textContent=questions[current];
    q.classList.remove("fade");
  },100);
  c.textContent=`${current+1}/${questions.length}`;
  cd.textContent="-"; setGauge(0);
}

function maybeChee(){
  if(!cheeCooldown && Math.random()<CHEE_CHANCE){
    pendingAdvance=true; cheeCooldown=true;
    setTimeout(startChee,300);
  }else{
    cheeCooldown=false;
    current++;
    current<questions.length?showQuestion():end();
  }
}

function shock(){
  game.classList.add("shock-on","shake","cut","announce-on");
  setTimeout(()=>{
    game.classList.remove("shock-on","shake");
    bg.style.backgroundImage=`url("${rand(GIRLS)}")`;
    setTimeout(()=>{
      game.classList.remove("cut","announce-on");
      startCheeTalk();
    },180);
  },220);
}

function startChee(){
  mode="chee"; locked=false;
  game.classList.add("chee-mode");
  shock();
}

function startCheeTalk(){
  q.textContent=""; s.textContent="";
  setTimeout(()=>{
    s.textContent="チー";
    beginTimer();
  },150);
}

function beginTimer(){
  const start=performance.now();
  raf=requestAnimationFrame(function tick(t){
    const r=Math.max(0,1-(t-start)/CHEE_TIME);
    cd.textContent=(CHEE_TIME*(r)/1000).toFixed(1);
    setGauge(r);
    if(r>0) raf=requestAnimationFrame(tick);
    else gameOver();
  });
}

function answer(choice){
  if(locked) return; locked=true;
  if(mode==="chee"){
    if(choice==="ギュウ"){
      stopTimer();
      pendingAdvance=false;
      current++;
      current<questions.length?showQuestion():end();
    }else gameOver();
    return;
  }
  s.textContent=choice==="チー"?"ギュウ":"……";
  setTimeout(maybeChee,650);
}

function gameOver(){
  stopTimer(); mode="end";
  bg.style.backgroundImage=`url("${END}")`;
  q.textContent=""; s.textContent="";
  choices.innerHTML=`<button class="big" onclick="restart()">もう一回</button>`;
  c.textContent="GAME OVER"; cd.textContent="-"; setGauge(0);
}

function end(){
  stopTimer(); mode="end";
  bg.style.backgroundImage=`url("${END}")`;
  q.textContent=""; s.textContent="";
  choices.innerHTML=`<button class="big" onclick="restart()">もう一回</button>`;
}

function restart(){
  current=0; cheeCooldown=false; pendingAdvance=false;
  buildButtons(); showQuestion();
}

document.getElementById("startBtn").onclick=()=>{
  document.getElementById("startScreen").classList.add("hide");
  game.classList.remove("hide");
  buildButtons(); restart();
};
window.restart=restart;
</script>

</body>
</html>
