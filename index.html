<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>チーと言えばギュウと答える</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",sans-serif;
}
.app{
  max-width:560px;
  margin:0 auto;
  min-height:100svh;
  display:flex;
  flex-direction:column;
}

/* header */
header{
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  font-size:12px;
  font-weight:700;
}

/* screens */
.screen{flex:1;position:relative;overflow:hidden}
.bg{
  position:absolute; inset:0;
  background-size:cover;
  background-position:center;
  transform:scale(1.02);
  transition:transform .35s ease, filter .35s ease;
}
#startScreen .bg{background-image:url("girl_top.png")}
.overlay{
  position:absolute; inset:0;
  padding:16px;
  display:flex;
}

/* start */
#startScreen .overlay{
  justify-content:center;
  align-items:flex-end;
  padding-bottom:28px;
}
.startPanel{text-align:center}
.startTitle{
  font-size:18px;
  font-weight:900;
  letter-spacing:.14em;
  margin-bottom:14px;
  text-shadow:0 8px 22px rgba(0,0,0,.75);
}
#startBtn{
  font-size:18px;
  padding:14px 28px;
  border:none;
  border-radius:14px;
  background:#ffffff22;
  color:#fff;
  font-weight:900;
}

/* game */
#gameScreen .overlay{
  flex-direction:column;
  justify-content:space-between;
}
#gameScreen.chee .bg{transform:scale(1.12)}
#gameScreen.hold .bg{filter:brightness(.92)}

.vignette{
  position:absolute;inset:0;
  pointer-events:none;
  opacity:0;
  background:radial-gradient(circle,
    rgba(0,0,0,0) 45%,
    rgba(0,0,0,.45) 100%);
  transition:opacity .25s;
}
#gameScreen.chee .vignette{opacity:1}

/* cut */
.cut{
  position:absolute;inset:0;
  background:#000;
  opacity:0;
  pointer-events:none;
  transition:opacity .28s;
}
#gameScreen.cut .cut{opacity:1}

/* announce */
.announce{
  position:absolute;inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:900;
  letter-spacing:.2em;
  opacity:0;
  pointer-events:none;
  transition:opacity .16s;
  text-shadow:0 10px 28px rgba(0,0,0,.85);
}
#gameScreen.announce .announce{opacity:1}

/* flash */
.flash{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.22);
  opacity:0;
  pointer-events:none;
  transition:opacity .08s ease-out;
}
.flash.on{ opacity:1; }

/* bubble */
.bubble{
  background:rgba(255,255,255,.08);
  border-radius:14px;
  padding:14px;
  min-height:120px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.question{
  font-size:20px;
  font-weight:700;          /* 問題文だけ少し太字 */
  line-height:1.45;
  opacity:1;
  transition:opacity .22s;
}
.question.hide{opacity:0}

.speech{
  align-self:flex-end;
  font-size:34px;
  font-weight:900;
  letter-spacing:.12em;
  min-height:40px;
  opacity:1;
  transform:scale(1);
}

/* チー娘の「チー！」（⭐︎⭐︎⭐︎だけ少し大きい） */
.cheeWord.big{ transform:scale(1.05); transform-origin:right bottom; }

/* ❤ */
.heartOnly{
  color:#ff2d55;
  text-shadow:0 8px 22px rgba(255,45,85,.35);
}
@keyframes heartPop{
  0%{ transform:scale(0.8); opacity:.0; }
  55%{ transform:scale(1.25); opacity:1; }
  100%{ transform:scale(1); opacity:1; }
}
.heartPop{ animation:heartPop .22s ease-out; }

/* ⭐︎⭐︎⭐︎背景揺れ（軽め） */
@keyframes bgShake {
  0%   { transform: translate(0, 0) scale(1.12); }
  20%  { transform: translate(-2px, 1px) scale(1.12); }
  40%  { transform: translate(2px, -1px) scale(1.12); }
  60%  { transform: translate(-1px, -2px) scale(1.12); }
  80%  { transform: translate(1px, 2px) scale(1.12); }
  100% { transform: translate(0, 0) scale(1.12); }
}
#gameScreen.chee.star3 .bg{ animation:bgShake .35s infinite; }

/* choices */
.choices{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.choice{
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:900;
  color:#fff;
}
.choice:disabled{opacity:.55}
.yes{background:#2e8b57}
.no{background:#555}
.cheeBtn{background:#2f6fb2}
.gyuuBtn{background:#e28a2f}

/* gauge (チー娘中だけ表示) */
.gauge{
  height:8px;
  background:#222;
  border-radius:999px;
  overflow:hidden;
  opacity:0;
  transform:translateY(8px);
  transition:opacity .16s, transform .16s;
  margin-bottom:10px;
}
.gauge.show{
  opacity:1;
  transform:translateY(0);
}
.gauge>div{
  height:100%;
  width:100%;
  transform-origin:left;
  transform:scaleX(0);
}

/* 難易度ごとのゲージ色 */
#gaugeBar.yellow{ background:linear-gradient(90deg,#ffe259,#ffa751); }
#gaugeBar.red{ background:linear-gradient(90deg,#ff416c,#ff4b2b); }

.hide{display:none}
</style>
</head>

<body>
<div class="app">

<header>
  <div>チーと言えばギュウと答える</div>
  <div id="counter">-</div>
</header>

<!-- START -->
<div id="startScreen" class="screen">
  <div class="bg"></div>
  <div class="overlay">
    <div class="startPanel">
      <div class="startTitle">ガチ！チー牛診断！！</div>
      <button id="startBtn">START</button>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="gameScreen" class="screen hide">
  <div class="bg"></div>
  <div class="vignette"></div>
  <div class="cut"></div>
  <div class="flash" id="flash"></div>
  <div class="announce">チー娘登場！！</div>

  <div class="overlay">
    <div class="bubble">
      <div id="question" class="question"></div>
      <div id="speech" class="speech"></div>
    </div>

    <div class="gauge" id="gaugeWrap"><div id="gaugeBar"></div></div>
    <div class="choices" id="choices"></div>
  </div>
</div>

</div>

<script>
/* ===== 画像 ===== */
const END_CLEAR_IMAGE = "girl_end.png";     // クリア
const END_GOVER_IMAGE = "girl_gover.png";   // チー娘負け（吹き出し無しver想定）

/* ===== 問題（45問） =====
   ※ "specialHeartOnGyuu" の問題だけ、ギュウ回答で ❤（ポップ+SE+フラッシュ） */
const questions = [
  { text:"あなたはチー牛ですか？" },
  { text:"チーと言えば？", specialHeartOnGyuu:true },
  { text:"石原さとみさんに「チー」と言われたら？" },
  { text:"ギュウと言ってもらいたい？" },
  { text:"チーズ牛丼を頼んだ人を一瞬だけ見てしまったことはありますか？" },
  { text:"知らない人を見て『チー牛かも』と思ってしまったことはありますか？" },
  { text:"あなたの友人にチー牛はいますか？" },
  { text:"大谷翔平選手に言ってほしい言葉第1位は『チー牛食おうぜ！』だと思いますか？" },
  { text:"麻雀には、チーをされた瞬間にギュウと答えるとチーを取り消す『チーギュウ返し』がある。本当だと思いますか？" },
  { text:"あなたは三度の飯よりチー牛が好きって本当ですか？" },

  { text:"あなたはチーズ牛丼の湯気でイケメンに見える時がありますか？" },
  { text:"あなたの好きな食べ物は1位チーズ牛丼特盛り、2位大盛り、3位並盛りですか？" },
  { text:"初めて麻雀をした時、チー/ポン/カンをチー/ギュウ/ドンと間違えたことがありますか？" },
  { text:"ハイチーズをハイチー牛だと思っていた時期がありますか？" },
  { text:"写真を撮る時、チーズ牛丼を持って写りそうになったことがありますか？" },

  { text:"チー牛は人口の2%しかいないと言われている。信じますか？" },
  { text:"チーと言われると、少しだけ反応してしまいますか？" },
  { text:"『ギュウ』と答える練習をしたことがありますか？" },
  { text:"チーズ牛丼を頼む人を見ると、なぜか目が行きますか？" },
  { text:"『チー牛かも』と思っても、口には出しませんか？" },

  { text:"牛カレーには牛肉、豚カレーには豚肉、鳥カレーには鶏肉、仮面ライダーカレーには仮面ライダーの肉が使われていると思いますか？" },
  { text:"『チーと言えばギュウ』は世界共通だと思いますか？" },
  { text:"チーズ牛丼を『恥ずかしくて頼めない』人は実在すると思いますか？" },
  { text:"あなたは『頼めないが、本当は食べたい』側ですか？" },
  { text:"チー牛食おうぜ！と言われたら、行けたら行くよ…と思いますか？" },

  { text:"コンビニでチーズ系を見ると、なぜか心がざわつきますか？" },
  { text:"牛丼屋で『チーズ』の文字を見ると一瞬迷いますか？" },
  { text:"『チー』と『ギュウ』を交互に発声したことがありますか？" },
  { text:"『チーと言えばギュウ』と聞いて、少し安心しますか？" },
  { text:"あなたは自分がチー牛かどうか、時々確認したくなりますか？" },

  { text:"『チー』と聞こえたら反射的に『ギュウ』が頭に浮かびますか？" },
  { text:"『ギュウ』と言う時、なぜか誇らしい気持ちになりますか？" },
  { text:"チーズ牛丼を食べた後、ちょっと強くなった気がしますか？" },
  { text:"『チー牛』という言葉を、心の中だけで使ったことはありますか？" },
  { text:"あなたはチー牛を『悪口』ではなく『概念』だと思いますか？" },

  { text:"チーズ牛丼のCMに石原さとみさんが出演し、イベントで本人に会える世界線があると思いますか？" },
  { text:"チーと言われたら、ギュウと返したいですか？" },
  { text:"ギュウと言ったら、相手に❤で返してほしいですか？" },
  { text:"『チーと言えばギュウ』は、人生のセーフティネットだと思いますか？" },
  { text:"『チー』と『ギュウ』の関係は、もはや運命だと思いますか？" },

  { text:"チーズ牛丼を頼んだ人を見て『分かる』と思ったことはありますか？" },
  { text:"『チー牛』という言葉を聞いても、怒らずスルーできますか？" },
  { text:"あなたは『チーと言えばギュウ』の正解率に自信がありますか？" },
  { text:"『ギュウ』と答えると世界が少し平和になると思いますか？" },
  { text:"最後にひとこと。チーと言えば？", specialHeartOnGyuu:true }
];

/* 女の子画像（通常時） */
const girls=["girl_1.png","girl_2.png","girl_3.png","girl_4.png","girl_5.png","girl_6.png"];

/* ===== チー娘 難易度 =====
   ⭐︎：今の色（寒色→暖色に変化）/ 時間ゆるめ
   ⭐︎⭐︎：黄色 / 時間短め
   ⭐︎⭐︎⭐︎：赤 / 時間さらに短い + 背景揺れ + 「チー！」5%大きい + ゲージ最初だけ減り速い */
const cheeLevels = [
  { stars:1, timeMs:2400, gauge:"cool",  weight:0.60 },
  { stars:2, timeMs:1700, gauge:"yellow",weight:0.30 },
  { stars:3, timeMs:1200, gauge:"red",   weight:0.10 }
];

/* もっさり＆演出 */
const NORMAL_REACT_MS = 1050;
const QUESTION_SHOW_DELAY = 100;       // 問題文表示 0.1秒遅らせる
const CHEE_PRE_HOLD_MS = 620;          // 暗転前の間
const CUT_MS = 320;                    // 暗転時間
const POST_CUT_HOLD_MS = 260;          // 暗転後の間
const CHEE_SILENCE_MS = 180;           // 登場後の溜め
const CHEE_SUCCESS_HOLD_MS = 700;      // ❤出たあと余韻
const GIRL_REPLY_DELAY_MS = 500;       // 返事を0.5秒遅らせる
const FLASH_ON_MS = 120;

/* チー娘出現率 */
const CHEE_RATE = 0.35;

/* ⭐︎⭐︎⭐︎：ゲージ最初だけ速い（0.5秒だけ倍率） */
const STAR3_BOOST_MS = 500;
const STAR3_BOOST_MULT = 1.35;

let i=0;
let mode="quiz";         // quiz | chee
let locked=false;
let rafId=0;
let cheeCooldown=false;
let ended=false;
let currentCheeLevel=null;

/* DOM */
const startScreen=document.getElementById("startScreen");
const game=document.getElementById("gameScreen");
const bg=document.querySelector("#gameScreen .bg");
const q=document.getElementById("question");
const s=document.getElementById("speech");
const c=document.getElementById("counter");
const gaugeWrap=document.getElementById("gaugeWrap");
const gauge=document.getElementById("gaugeBar");
const choices=document.getElementById("choices");
const flash=document.getElementById("flash");

/* ===== WebAudio: 작은 "ポン" SE ===== */
let audioCtx=null;
function ensureAudio(){
  if(!audioCtx){
    const AC = window.AudioContext || window.webkitAudioContext;
    audioCtx = new AC();
  }
  if(audioCtx.state === "suspended") audioCtx.resume();
}
function playPopSE(){
  try{
    ensureAudio();
    const t0 = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "sine";
    osc.frequency.setValueAtTime(660, t0);
    osc.frequency.exponentialRampToValueAtTime(880, t0 + 0.03);

    gain.gain.setValueAtTime(0.0001, t0);
    gain.gain.exponentialRampToValueAtTime(0.18, t0 + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.10);

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(t0);
    osc.stop(t0 + 0.11);
  }catch(e){}
}

/* helpers */
function randGirl(){ return girls[Math.floor(Math.random()*girls.length)]; }
function shuffle(a){ return a.slice().sort(()=>Math.random()-0.5); }
function setButtonsEnabled(on){
  document.querySelectorAll("#choices button").forEach(b=>b.disabled=!on);
}
function stopCheeTimer(){
  cancelAnimationFrame(rafId);
  rafId=0;
}
function hideGauge(){
  gaugeWrap.classList.remove("show");
  gauge.style.transform="scaleX(0)";
}
function showGauge(){
  gaugeWrap.classList.add("show");
}
function resetCheeVisuals(){
  game.classList.remove("chee","cut","announce","hold","star3");
  hideGauge();
  stopCheeTimer();
  gauge.classList.remove("yellow","red");
  currentCheeLevel=null;
}

/* flash */
function flashBg(){
  flash.classList.add("on");
  setTimeout(()=> flash.classList.remove("on"), FLASH_ON_MS);
}

/* speech */
function clearSpeech(){
  s.className = "speech";
  s.textContent = "";
}
function setSpeechPlain(text){
  s.className = "speech";
  s.textContent = text;
}
function setHeartOnlyPop(){
  s.className = "speech heartOnly";
  s.textContent = "❤";
  s.classList.remove("heartPop");
  void s.offsetWidth;
  s.classList.add("heartPop");
  playPopSE();
  flashBg();
}
function setGyuuWithHeart(){
  s.className = "speech";
  s.innerHTML = `ギュウ<span class="heartOnly">❤</span>`;
}

/* UI */
function buildChoices(){
  choices.innerHTML="";
  const items=[["はい","yes"],["いいえ","no"],["チー","chee"],["ギュウ","gyuu"]];
  shuffle(items).forEach(([t,cl])=>{
    const b=document.createElement("button");
    b.textContent=t;
    b.className=`choice ${cl==="chee"?"cheeBtn":cl==="gyuu"?"gyuuBtn":cl}`;
    b.onclick=()=>answer(t);
    choices.appendChild(b);
  });
}

/* 1問ごとに女の子画像変える */
function applyQuestionBg(){
  bg.style.backgroundImage=`url("${girls[i % girls.length]}")`;
}

function showQuestion(){
  ended=false;
  locked=false;
  mode="quiz";
  resetCheeVisuals();

  applyQuestionBg();

  q.classList.add("hide");
  q.textContent=questions[i].text;
  clearSpeech();
  c.textContent=`${i+1}/${questions.length}`;

  setTimeout(()=> q.classList.remove("hide"), QUESTION_SHOW_DELAY);
  setButtonsEnabled(true);
}

/* チー娘難易度抽選 */
function pickCheeLevel(){
  const r = Math.random();
  let acc = 0;
  for(const lv of cheeLevels){
    acc += lv.weight;
    if(r <= acc) return lv;
  }
  return cheeLevels[0];
}

/* flow */
function maybeChee(){
  // 最終問題後はチー娘を出さずに終了
  if(i >= questions.length-1){
    i++;
    if(i < questions.length) showQuestion();
    else end();
    return;
  }
  if(ended) return;

  if(!cheeCooldown && Math.random() < CHEE_RATE){
    cheeCooldown=true;

    setButtonsEnabled(false);
    game.classList.add("hold");
    setTimeout(()=>{
      game.classList.remove("hold");
      startChee();
    }, CHEE_PRE_HOLD_MS);
  }else{
    cheeCooldown=false;
    i++;
    if(i < questions.length) showQuestion();
    else end();
  }
}

function startChee(){
  if(ended) return;
  mode="chee";
  locked=false;

  currentCheeLevel = pickCheeLevel();

  game.classList.add("cut","announce","chee");
  if(currentCheeLevel.stars === 3){
    game.classList.add("star3");
  }

  // チー娘画像
  bg.style.backgroundImage=`url("${randGirl()}")`;

  setTimeout(()=>{
    game.classList.remove("cut","announce");

    // 問題文は消す
    q.textContent="";
    q.classList.add("hide");
    clearSpeech();

    setTimeout(()=>{
      // チー！表示（⭐︎⭐︎⭐︎だけ5%大きく）
      s.className = "speech cheeWord" + (currentCheeLevel.stars===3 ? " big" : "");
      s.textContent = "チー！";

      startCheeTimer(currentCheeLevel);
      setButtonsEnabled(true);
    }, CHEE_SILENCE_MS);

  }, CUT_MS + POST_CUT_HOLD_MS);
}

function startCheeTimer(level){
  stopCheeTimer();
  showGauge();

  // ゲージ色
  gauge.classList.remove("yellow","red");
  if(level.gauge === "yellow") gauge.classList.add("yellow");
  if(level.gauge === "red") gauge.classList.add("red");

  const start=performance.now();

  const tick=(t)=>{
    let elapsed = t - start;

    // ⭐︎⭐︎⭐︎：最初だけ減少を速く
    if(level.stars === 3 && elapsed < STAR3_BOOST_MS){
      elapsed = elapsed * STAR3_BOOST_MULT;
    }else if(level.stars === 3 && elapsed >= STAR3_BOOST_MS){
      // 速くした分のズレを足して、自然につながるようにする
      const boosted = STAR3_BOOST_MS * STAR3_BOOST_MULT;
      elapsed = boosted + (elapsed - STAR3_BOOST_MS);
    }

    const r = Math.max(0, 1 - (elapsed / level.timeMs));
    gauge.style.transform = `scaleX(${r})`;

    // ⭐︎（今の色）：寒色→暖色へ
    if(level.gauge === "cool"){
      gauge.style.background = `hsl(${210 * r}, 85%, 55%)`;
    }

    if(r > 0){
      rafId = requestAnimationFrame(tick);
    }else{
      gameOver(); // チー娘で時間切れ＝ゲームオーバー
    }
  };

  rafId = requestAnimationFrame(tick);
}

/* answer */
function answer(t){
  if(locked || ended) return;
  locked=true;
  setButtonsEnabled(false);

  ensureAudio();
  q.classList.add("hide");

  if(mode==="chee"){
    // チー娘：ギュウ以外は即ゲームオーバー
    if(t==="ギュウ"){
      stopCheeTimer();
      hideGauge();

      // こちらの「ギュウ」は表示しない（チー！は残す）
      setTimeout(()=> setHeartOnlyPop(), GIRL_REPLY_DELAY_MS);

      setTimeout(()=>{
        resetCheeVisuals();
        i++;
        if(i < questions.length) showQuestion();
        else end();
      }, GIRL_REPLY_DELAY_MS + CHEE_SUCCESS_HOLD_MS);

    }else{
      gameOver();
    }
    return;
  }

  const isSpecialHeart = !!questions[i].specialHeartOnGyuu;

  setTimeout(()=>{
    // 「チーと言えば？」など specialHeartOnGyuu の問題でギュウ→❤（ポップ）
    if(isSpecialHeart && t==="ギュウ"){
      setHeartOnlyPop();
    }
    // チーを押した時だけ：ギュウ❤
    else if(t==="チー"){
      setGyuuWithHeart();
    }
    // それ以外：笑
    else{
      setSpeechPlain("笑");
    }
  }, GIRL_REPLY_DELAY_MS);

  setTimeout(maybeChee, GIRL_REPLY_DELAY_MS + NORMAL_REACT_MS);
}

/* end / gameover */
function end(){
  ended=true;
  resetCheeVisuals();

  bg.style.backgroundImage = `url("${END_CLEAR_IMAGE}")`;
  q.textContent="";
  clearSpeech();

  choices.innerHTML = `
    <button class="choice gyuuBtn" style="grid-column:1/-1" onclick="restart()">
      もう一回
    </button>
  `;
  c.textContent = `${questions.length}/${questions.length}`;
}

function gameOver(){
  ended=true;
  resetCheeVisuals();

  bg.style.backgroundImage = `url("${END_GOVER_IMAGE}")`;
  q.textContent="";
  clearSpeech();

  // 画像側に吹き出し無しになったので、ここでテキスト表示
  setSpeechPlain("あなたチー牛じゃなかったのね。。");

  choices.innerHTML = `
    <button class="choice gyuuBtn" style="grid-column:1/-1" onclick="restart()">
      もう一回
    </button>
  `;
  c.textContent = "GAME OVER";
}

function restart(){
  ended=false;
  cheeCooldown=false;
  i=0;
  buildChoices();
  showQuestion();
}

/* start */
document.getElementById("startBtn").onclick=()=>{
  startScreen.classList.add("hide");
  game.classList.remove("hide");
  buildChoices();
  showQuestion();
};

window.restart=restart;
</script>

</body>
</html>
