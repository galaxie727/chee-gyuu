<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>チーと言えばギュウと答える</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",sans-serif;
}
.app{
  max-width:560px;
  margin:0 auto;
  min-height:100svh;
  display:flex;
  flex-direction:column;
}

/* header */
header{
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  font-size:12px;
  font-weight:700;
}

/* screens */
.screen{flex:1;position:relative;overflow:hidden}
.bg{
  position:absolute; inset:0;
  background-size:cover;
  background-position:center;
  transform:scale(1.02);
  transition:transform .35s ease, filter .35s ease;
}
#startScreen .bg{background-image:url("girl_top.png")}
.overlay{
  position:absolute; inset:0;
  padding:16px;
  display:flex;
}

/* start */
#startScreen .overlay{
  justify-content:center;
  align-items:flex-end;
  padding-bottom:28px;
}
.startPanel{text-align:center}
.startTitle{
  font-size:18px;
  font-weight:900;
  letter-spacing:.14em;
  margin-bottom:14px;
  text-shadow:0 8px 22px rgba(0,0,0,.75);
}
#startBtn{
  font-size:18px;
  padding:14px 28px;
  border:none;
  border-radius:14px;
  background:#ffffff22;
  color:#fff;
  font-weight:900;
}

/* game */
#gameScreen .overlay{
  flex-direction:column;
  justify-content:space-between;
}
#gameScreen.chee .bg{transform:scale(1.12)}
#gameScreen.hold .bg{filter:brightness(.92)}

.vignette{
  position:absolute;inset:0;
  pointer-events:none;
  opacity:0;
  background:radial-gradient(circle,
    rgba(0,0,0,0) 45%,
    rgba(0,0,0,.45) 100%);
  transition:opacity .25s;
}
#gameScreen.chee .vignette{opacity:1}

/* cut */
.cut{
  position:absolute;inset:0;
  background:#000;
  opacity:0;
  pointer-events:none;
  transition:opacity .28s;
}
#gameScreen.cut .cut{opacity:1}

/* shake */
@keyframes shake{
  0%{transform:translate(0,0)}
  25%{transform:translate(-4px,2px)}
  50%{transform:translate(3px,-2px)}
  75%{transform:translate(-2px,1px)}
  100%{transform:translate(0,0)}
}
#gameScreen.shake{animation:shake .12s}

/* announce */
.announce{
  position:absolute;inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:900;
  letter-spacing:.2em;
  opacity:0;
  pointer-events:none;
  transition:opacity .16s;
  text-shadow:0 10px 28px rgba(0,0,0,.85);
}
#gameScreen.announce .announce{opacity:1}

/* ===== ❤フラッシュ用レイヤー ===== */
.flash{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.22); /* 弱め */
  opacity:0;
  pointer-events:none;
  transition:opacity .08s ease-out;
}
.flash.on{ opacity:1; }

/* bubble */
.bubble{
  background:rgba(255,255,255,.08);
  border-radius:14px;
  padding:14px;
  min-height:120px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.question{
  font-size:20px;
  font-weight:600;
  line-height:1.45;
  opacity:1;
  transition:opacity .22s;
}
.question.hide{opacity:0}

.speech{
  align-self:flex-end;
  font-size:34px;
  font-weight:900;
  letter-spacing:.12em;
  min-height:40px;
  opacity:1;
  transform:scale(1);
}

/* ❤表示（赤） */
.heartOnly{
  color:#ff2d55;
  text-shadow:0 8px 22px rgba(255,45,85,.35);
}

/* ❤ポップ演出 */
@keyframes heartPop{
  0%{ transform:scale(0.8); }
  55%{ transform:scale(1.25); }
  100%{ transform:scale(1); }
}
.heartPop{
  animation:heartPop .22s ease-out;
}

/* choices */
.choices{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.choice{
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:900;
  color:#fff;
}
.choice:disabled{opacity:.55}
.yes{background:#2e8b57}
.no{background:#555}
.cheeBtn{background:#2f6fb2}
.gyuuBtn{background:#e28a2f}

/* gauge (チー娘中だけ表示) */
.gauge{
  height:8px;
  background:#222;
  border-radius:999px;
  overflow:hidden;
  opacity:0;
  transform:translateY(8px);
  transition:opacity .16s, transform .16s;
  margin-bottom:10px;
}
.gauge.show{
  opacity:1;
  transform:translateY(0);
}
.gauge>div{
  height:100%;
  width:100%;
  transform-origin:left;
  transform:scaleX(0);
}

.hide{display:none}
</style>
</head>

<body>
<div class="app">

<header>
  <div>チーと言えばギュウ</div>
  <div id="counter">-</div>
</header>

<!-- START -->
<div id="startScreen" class="screen">
  <div class="bg"></div>
  <div class="overlay">
    <div class="startPanel">
      <div class="startTitle">ガチ！チー牛診断！！</div>
      <button id="startBtn">START</button>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="gameScreen" class="screen hide">
  <div class="bg"></div>
  <div class="vignette"></div>
  <div class="cut"></div>
  <div class="flash" id="flash"></div>
  <div class="announce">チー娘登場！！</div>

  <div class="overlay">
    <div class="bubble">
      <div id="question" class="question"></div>
      <div id="speech" class="speech"></div>
    </div>

    <div class="gauge" id="gaugeWrap"><div id="gaugeBar"></div></div>
    <div class="choices" id="choices"></div>
  </div>
</div>

</div>

<script>
/* ===== Questions (15) ===== */
const questions=[
  "あなたはチー牛ですか？",
  "チーと言えば？",
  "石原さとみさんに「チー」と言われたら？",
  "ギュウと言ってもらいたい？",
  "チーズ牛丼を頼んだ人を一瞬見たことある？",
  "知らない人を見て「チー牛かも」と思ったことある？",
  "あなたの友人にチー牛はいますか？",
  "チー牛は恥ずかしくてチーズ牛丼は頼めないが本当は食べたい？",
  "チー牛食おうぜ！と言われたら行く？",
  "ハイチーズをハイチー牛だと思ったことある？",
  "麻雀のチー/ポン/カンをチー/ギュウ/ドンと間違えたことある？",
  "チーズ牛丼の湯気でイケメンに見える時がある？",
  "あなたの好きな食べ物はチーズ牛丼特盛り？",
  "麻雀にはチーギュウ返しがあると思う？",
  "あなたは三度の飯よりチー牛が好きって本当ですか？"
];

const girls=["girl_1.png","girl_2.png","girl_3.png","girl_4.png","girl_5.png","girl_6.png"];
const END="girl_end.png";

/* chee interrupt */
const CHEE_RATE=.35;
const CHEE_TIME=2400;

/* pacing */
const NORMAL_REACT_MS = 950;
const QUESTION_FADEIN_DELAY = 160;
const CHEE_PRE_HOLD_MS = 520;
const CUT_MS = 260;
const POST_CUT_HOLD_MS = 220;
const CHEE_SILENCE_MS = 150;
const CHEE_SUCCESS_HOLD_MS = 650;

/* girl reply delay */
const GIRL_REPLY_DELAY_MS = 500;

/* flash timing */
const FLASH_ON_MS = 120;

let i=0;
let mode="quiz";
let locked=false;
let rafId=0;
let cheeCooldown=false;
let ended=false;

/* DOM */
const game=document.getElementById("gameScreen");
const bg=document.querySelector("#gameScreen .bg");
const q=document.getElementById("question");
const s=document.getElementById("speech");
const c=document.getElementById("counter");
const gaugeWrap=document.getElementById("gaugeWrap");
const gauge=document.getElementById("gaugeBar");
const choices=document.getElementById("choices");
const flash=document.getElementById("flash");

/* ===== WebAudio: 작은 "ポン" SE ===== */
let audioCtx=null;
function ensureAudio(){
  if(!audioCtx){
    const AC = window.AudioContext || window.webkitAudioContext;
    audioCtx = new AC();
  }
  if(audioCtx.state === "suspended") audioCtx.resume();
}
function playPopSE(){
  try{
    ensureAudio();
    const t0 = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "sine";
    osc.frequency.setValueAtTime(660, t0);
    osc.frequency.exponentialRampToValueAtTime(880, t0 + 0.03);

    gain.gain.setValueAtTime(0.0001, t0);
    gain.gain.exponentialRampToValueAtTime(0.18, t0 + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.10);

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(t0);
    osc.stop(t0 + 0.11);
  }catch(e){}
}

/* helpers */
function randGirl(){ return girls[Math.floor(Math.random()*girls.length)]; }
function shuffle(a){ return a.slice().sort(()=>Math.random()-0.5); }
function setButtonsEnabled(on){
  document.querySelectorAll("#choices button").forEach(b=>b.disabled=!on);
}
function stopCheeTimer(){
  cancelAnimationFrame(rafId);
  rafId=0;
}
function hideGauge(){
  gaugeWrap.classList.remove("show");
  gauge.style.transform="scaleX(0)";
}
function showGauge(){
  gaugeWrap.classList.add("show");
}
function resetCheeVisuals(){
  game.classList.remove("chee","cut","announce","shake","hold");
  hideGauge();
  stopCheeTimer();
}

/* flash */
function flashBg(){
  flash.classList.add("on");
  setTimeout(()=> flash.classList.remove("on"), FLASH_ON_MS);
}

/* speech */
function clearSpeech(){
  s.className = "speech";
  s.textContent = "";
}
function setSpeechPlain(text){
  s.className = "speech";
  s.textContent = text;
}
function setHeartOnlyPop(){
  s.className = "speech heartOnly";
  s.textContent = "❤";
  s.classList.remove("heartPop");
  void s.offsetWidth;
  s.classList.add("heartPop");

  playPopSE();
  flashBg();
}
function setGyuuWithHeart(){
  s.className = "speech";
  s.innerHTML = `ギュウ<span class="heartOnly">❤</span>`;
}

/* UI */
function buildChoices(){
  choices.innerHTML="";
  const items=[["はい","yes"],["いいえ","no"],["チー","chee"],["ギュウ","gyuu"]];
  shuffle(items).forEach(([t,cl])=>{
    const b=document.createElement("button");
    b.textContent=t;
    b.className=`choice ${cl==="chee"?"cheeBtn":cl==="gyuu"?"gyuuBtn":cl}`;
    b.onclick=()=>answer(t);
    choices.appendChild(b);
  });
}

function showQuestion(){
  ended=false;
  locked=false;
  mode="quiz";
  resetCheeVisuals();

  bg.style.backgroundImage=`url("${girls[i%girls.length]}")`;

  q.classList.add("hide");
  q.textContent=questions[i];
  clearSpeech();
  c.textContent=`${i+1}/${questions.length}`;

  setTimeout(()=> q.classList.remove("hide"), QUESTION_FADEIN_DELAY);
  setButtonsEnabled(true);
}

/* flow */
function maybeChee(){
  if(i >= questions.length-1){
    i++;
    if(i < questions.length) showQuestion();
    else end();
    return;
  }
  if(ended) return;

  if(!cheeCooldown && Math.random() < CHEE_RATE){
    cheeCooldown=true;

    setButtonsEnabled(false);
    game.classList.add("hold");
    setTimeout(()=>{
      game.classList.remove("hold");
      startChee();
    }, CHEE_PRE_HOLD_MS);
  }else{
    cheeCooldown=false;
    i++;
    if(i < questions.length) showQuestion();
    else end();
  }
}

function startChee(){
  if(ended) return;
  mode="chee";
  locked=false;

  game.classList.add("shake","cut","announce");

  setTimeout(()=>{
    game.classList.remove("shake");
    game.classList.add("chee");
    bg.style.backgroundImage=`url("${randGirl()}")`;

    setTimeout(()=>{
      game.classList.remove("cut","announce");

      q.textContent="";
      q.classList.add("hide");
      clearSpeech();

      setTimeout(()=>{
        setSpeechPlain("チー");
        startCheeTimer();
        setButtonsEnabled(true);
      }, CHEE_SILENCE_MS);

    }, POST_CUT_HOLD_MS);

  }, CUT_MS);
}

function startCheeTimer(){
  stopCheeTimer();
  showGauge();

  const start=performance.now();
  const tick=(t)=>{
    const r=Math.max(0,1-(t-start)/CHEE_TIME);
    gauge.style.transform=`scaleX(${r})`;
    gauge.style.background=`hsl(${210*r},85%,55%)`;
    if(r>0){
      rafId=requestAnimationFrame(tick);
    }else{
      gameOver();
    }
  };
  rafId=requestAnimationFrame(tick);
}

/* answer */
function answer(t){
  if(locked || ended) return;
  locked=true;
  setButtonsEnabled(false);

  ensureAudio();

  q.classList.add("hide");

  if(mode==="chee"){
    if(t==="ギュウ"){
      stopCheeTimer();
      hideGauge();

      /* こちらの「ギュウ」は表示しない（チーは残す） */
      setTimeout(()=>{
        setHeartOnlyPop(); // ❤ポップ + SE + フラッシュ
      }, GIRL_REPLY_DELAY_MS);

      setTimeout(()=>{
        resetCheeVisuals();
        i++;
        if(i < questions.length) showQuestion();
        else end();
      }, GIRL_REPLY_DELAY_MS + CHEE_SUCCESS_HOLD_MS);

    }else{
      gameOver();
    }
    return;
  }

  const isChiiToIeBa = (questions[i] === "チーと言えば？");

  setTimeout(()=>{
    if(isChiiToIeBa && t==="ギュウ"){
      setHeartOnlyPop();     // ❤のみ（ポップ+SE+フラッシュ）
    }else if(t==="チー"){
      setGyuuWithHeart();    // ギュウ❤（※ここはフラッシュ無し）
    }else{
      setSpeechPlain("笑");
    }
  }, GIRL_REPLY_DELAY_MS);

  setTimeout(maybeChee, GIRL_REPLY_DELAY_MS + NORMAL_REACT_MS);
}

/* end/gameover */
function end(){
  ended=true;
  resetCheeVisuals();
  bg.style.backgroundImage=`url("${END}")`;
  q.textContent="";
  clearSpeech();
  choices.innerHTML=`<button class="choice gyuuBtn" style="grid-column:1/-1" onclick="restart()">もう一回</button>`;
  c.textContent=`${questions.length}/${questions.length}`;
}

function gameOver(){
  ended=true;
  resetCheeVisuals();
  bg.style.backgroundImage=`url("${END}")`;
  q.textContent="";
  clearSpeech();
  choices.innerHTML=`<button class="choice gyuuBtn" style="grid-column:1/-1" onclick="restart()">もう一回</button>`;
  c.textContent="GAME OVER";
}

function restart(){
  ended=false;
  cheeCooldown=false;
  i=0;
  buildChoices();
  showQuestion();
}

/* start */
document.getElementById("startBtn").onclick=()=>{
  document.getElementById("startScreen").classList.add("hide");
  game.classList.remove("hide");
  buildChoices();
  showQuestion();
};
window.restart=restart;
</script>

</body>
</html>
